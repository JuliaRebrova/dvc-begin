# DVC для начинающих


## Подготовка репозитория
Создается гит репозиторий, скрипты загрузки и обработки данных, модуль обучения - обычный проект.
Инициализируется dvc  
```
dvc init
commit dvc init
git commit -m "Initialize DVC"
```

Добавим удаленный репозиторий. В нем будут храниться сами файлы, в то время как в гите хранятся только ссылки на них
```
dvc remote add name_of_storage path/or/url/to/storage
```
После выполнения команды в файле .dvc/config должна появиться запись (ее можно создать вручную)
```
[core]
    remote = remote_storage
['remote "name_of_storage"']
    url = path/or/url/to/storage
```

## Добавление файлов вручную
Если работа с пайплайнами не предполагается, можно добавить файлы вручную  
```
dvc add filename.example
```
После выполнения такой команды появится гитигнор, в который добавлен указанный filename.example  
А также файл `filename.example.dvc`.  
Последний нужно отправить в гит (это образ или ссылка на файл в удаленном хранилище)

Для добавления файла в удаленный репозиторий выполнить команду  
```
dvc push
```
Чтобы подгрузить файлы из хранилища необходимо выполнить 
```
dvc checkout
```

## Создание пайплайнов
Пайплайны сами создают и отправляют ссылки на ипользуемые в нем файлы, добавлять их вручную в dvc не нужно.  
Пайплайн представляет собой набор файлов которые используются для запуска и которые являются артефактами.  

Так для тренировки модели используется скрипт train_model.py и датасет, а в результате сохраняется артефакт - модель.  
В конце указывается команда, которая запускает этот пайплайн.

```
dvc stage add -n train2 \
-d app/train_model.py \
-d data/row_dataset.xlsx \
-o models/model.joblib \
python app/train_model.py
```
Используемые файлы должны быть подгружены в локальный репозиторий.  

Если результатом работы пайплайна является метрика, для нее есть отдельный флаг, который можно трекать впоследствие.  
-m вместо -o.

```
dvc stage add -n eval \
-d app/make_predictions.py \
-d data/row_dataset.xlsx \
-m metrics/metrics.txt \
python app/make_predictions.py
```
Для выполнения пайплайна необходимо запустить 
```
dvc repro название-пайплайна
```

Если файлы были обновлены, выполнить dvc push. 
Образы файлов загрузить в гит.
